///setting
template = article;
///

# 自作SSG × k8s × Cloudflare Tunnelでブログを作る

この記事は、[KMC Advent Calendar 2022](https://adventar.org/calendars/8005) の 18日目の記事です。

こんにちはこんにちは。KMC 46th、現会長のWalnutsです。今日はクリスマスですね...（すっとぼけ）大遅刻ぶちかましてますが気にせず書いていこうと思います。

最近私はk8sに大はまり中で、ほとんどのサービスを自宅k8sに移行しました。順調に稼働できていますが、唯一の問題点としてRaspberry Pi 4 RAM 2GBを用いているのでかなりのスペック不足だということです。当然SWAPも無理やりオンにしないとメモリが足りないのです。自分でもどうしてこの環境で問題なく動いているのかわかりません。ラズパイ在庫が復活したら3node目を建てたいと思います。（2 node目は電気代をケチって常時稼働させていないamd64 node）

さてさて、今回はそんな限界k8s上にブログを立てたいと思います。限界環境なのでWordPressなんて動くわけがありません。なので今回は静的サイトを立てていきましょう。

## SSG？

SSGは「静的サイトジェネレータ」です。MarkDownだったりTexだったりで書いた文章をHTMLに変換するものです。これを使えば素のHTMLを書く必要はありません。調べるといろいろあるようですが見た目いじったりする方法がよくわからないので自分で作っちゃいます。

## 流れ

JSだったりGoだったりで書くとよさそうですが書けないのでC#で作ります（？）

GitHubに元となるテキストをコミット

↓

GitHub ActionsでDockerを動かして、HTMLを生成

↓

k8s上のnginxにデプロイ

こんな感じの流れで自動化を実現しようと思います。
## SSG部分の作成
自分用なのでかなーーーり雑に書いて行きましょう。

やるべき変換を挙げていくと、

- #や##を\<h1>、\<h2>に
- ~~ を\<s>に
- \* を\<em>に
- ** を\<strong>に
- テキストを改行部分で\<p>に
- \[]() を\<a href="">に
- !\[]() を\<img>に
- \- を順序なしリストに
- \``` 言語:ファイル名 を\<pre>\<code> & エスケープ & hightlight.jsに

パッと使いそうなのはこれくらいでしょうか。これプラスHTMlタグも使えるようにすれば問題ないかな～と思っています。


早速書いていきます。基本的には正規表現で書いていっています。
```c_sharp

```